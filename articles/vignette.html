<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>User Guide • gaea</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="User Guide">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gaea</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>

  </a>
</li>
<li>
  <a href="../articles/vignette.html">
    <span class="fas fa-book"></span>

    User Guide
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>

    Reference
  </a>
</li>
<li>
  <a href="../news/index.html">
    <span class="fa fa-newspaper-o"></span>

    News
  </a>
</li>
<li>
  <a href="../CONTRIBUTING.html">Contribute</a>
</li>
<li>
  <a href="../CITATION.html">
    <span class="fas fa-quote-left"></span>

    Citation
  </a>
</li>
<li>
  <a href="../SUPPORT.html">
    <span class="fas fa-question"></span>

    Support
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/JGCRI/gaea/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>User Guide</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/JGCRI/gaea/blob/main/vignettes/vignette.Rmd" class="external-link"><code>vignettes/vignette.Rmd</code></a></small>
      <div class="hidden name"><code>vignette.Rmd</code></div>

    </div>

    
    
<!-------------------------->
<!-------------------------->
<!-- HTML styles items    -->
<!-------------------------->
<!-------------------------->
<style>
.button {
  background-color: #555555;
  border-radius: 8px;
  border: none;
  color: white;
  padding: 15px 32px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  margin: 4px 2px;
  cursor: pointer;
}

.button:hover {
  box-shadow: 0 12px 16px 0 rgba(0,0,0,0.24), 0 17px 50px 0 rgba(0,0,0,0.19);
  background-color: #555555;
  color: gold;
}

p.comment {
background-color: #DBDBDB;
padding: 10px;
border: 1px solid black;
margin-left: 25px;
border-radius: 5px;
font-style: italic;
}

</style>
<!--------------------------><!--------------------------><div class="section level2">
<h2 id="workflow">Workflow<a class="anchor" aria-label="anchor" href="#workflow"></a>
</h2>
<!-------------------------->
<!-------------------------->
<p align="center">
<img src="vignetteFigs/divider.png"></p>
<p><code>gaea</code> is designed with a climate-driven empirical model
at its core, integrated into an efficient modular structure. This
architecture streamlines the entire workflow, from initial climate and
crop data processing through empirical model fitting, yield shock
projections under future climate scenarios, to the calculation of
agricultural productivity changes for GCAM. The modular design also
facilitates comprehensive diagnostic outputs, enhancing the tool’s
utility for researchers and policymakers.</p>
<p>The primary functionality of <code>gaea</code> is encapsulated in the
<code>yield_impact</code> wrapper function, which executes the entire
workflow from climate data processing to yield shock estimation. Users
can also execute individual functions to work through the main steps of
the process (). Detailed instructions on <code>gaea</code> can be
accessed at <a href="https://jgcri.github.io/gaea" class="external-link uri">https://jgcri.github.io/gaea</a>.</p>
<ol style="list-style-type: decimal">
<li><p><code>weighted_climate</code>: Processes CMIP-ISIMIP climate
NetCDF data and calculates cropland-weighted precipitation and
temperature at the country level, differentiated by crop type and
irrigation type. The function accepts both daily or monthly climate
data.</p></li>
<li><p><code>crop_calenders</code>: Generates crop planting months for
each country based on crop calendar data from <a href="https:/doi/org/10.1111/j.1466-8238.2010.00551.x">Sacks et al.,
(2020)</a>.</p></li>
<li><p><code>data_aggregation</code>: Calculates crop growing seasons
using climate variables processed by <code>weighted_climate</code> and
crop calendars for both historical and projected periods. This function
prepares climate and yield data for subsequent model fitting.</p></li>
<li><p><code>yield_regression</code>: Performs regression analysis based
on historical crop yields and climate variations. The default
econometric model applied in <code>gaea</code> is from <a href="https://doi.org/10.1088/1748-9326/abadcb" class="external-link">Waldhoff et al.,
(2020)</a>. User can provide other formulas as long as it is using the
same data from <code>data_aggregation</code>.</p></li>
<li><p><code>yield_projection</code>: Projects yield shocks for future
climate scenarios using the fitted model.</p></li>
<li><p><code>gcam_agprodchange</code>: Remaps country-level yield shocks
to GCAM-required spatial scales (i.e., region and basin intersections)
based on harvest area and converts crops to GCAM commodities. This
function calculates agricultural productivity growth (a key parameter
for GCAM to estimate future yield) and creates ready-to-use XML outputs
for GCAM.</p></li>
</ol>
<p><br></p>
<p align="center">
<img src="vignetteFigs/workflow.jpg"></p>
<a name="figure1"></a>
<p align="left" style="font-size:14px;">
<strong>Figure 1:</strong> The gaea workflow showing the functions and
the corresponding outputs of modeling crop yield shocks to climate
variations using empritical econometric model.
</p>
<p><br></p>
<!-------------------------->
<!-------------------------->
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<!-------------------------->
<!-------------------------->
<p align="center">
<img src="vignetteFigs/divider.png"></p>
<div class="section level3">
<h3 id="example-climate-data">Example Climate Data<a class="anchor" aria-label="anchor" href="#example-climate-data"></a>
</h3>
<p><code>gaea</code> requires global climate data from the
Inter-Sectoral Impact Model Intercomparison Project (<a href="https://www.isimip.org/" class="external-link">ISIMIP</a>) or data with the same format
of ISIMIP data. In addition, <code>gaea</code> also allows climate data
that has been aggregated to monthly time step. Given the large size of
the climate data at daily time step, we have provided an example climate
data at monthly time step from 2015 to 2100 ((download link)[]). Please
download the data and make sure to unzip the data to your desired
location.</p>
<div class="alert alert-info">
<p><strong>NOTE:</strong> In the case where there is no available
historical climate data, <code>gaea</code> will use the default fitted
model that has already been fitted with WATCH historical climate forcing
data (<a href="https://doi.org/10.1175/2011JHM1369.1" class="external-link">Weedon et al.,
(2011)</a>).</p>
</div>
</div>
<div class="section level3">
<h3 id="run-gaea">Run gaea!<a class="anchor" aria-label="anchor" href="#run-gaea"></a>
</h3>
<p>Once the example data is in place, we can run <code>gaea</code> with
a single function <code>yield_impact</code> that streamlines the entire
workflow. For the explanation of each argument of
<code>yield_impact</code>, refer to this <a href="https://jgcri.github.io/gaea/reference/yield_impact.html" class="external-link">reference
page</a>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># load gaea</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(gaea)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: please change `data_dir` to your desired location for downloaded data</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>data_dir <span class="ot">&lt;-</span> gaea<span class="sc">::</span><span class="fu">get_example_data</span>(</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>  <span class="at">download_url =</span> <span class="st">'https://zenodo.org/records/13179630/files/gaea_example_climate.zip?download=1'</span>,</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>  <span class="at">data_dir =</span> <span class="st">'path/to/desired/location'</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>)</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="co"># Path to the climate NetCDF files</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: Each variable can have more than one file</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="co"># historical climate data</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>pr_historical_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(data_dir, <span class="st">'pr_monthly_canesm5_w5e5_rcp7_1950_2014.nc'</span>)</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>tas_historical_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(data_dir, <span class="st">'tas_monthly_canesm5_w5e5_rcp7_1950_2014.nc'</span>)</span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a><span class="co"># projected climate data</span></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>pr_projection_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(data_dir, <span class="st">'pr_monthly_canesm5_w5e5_rcp7_2015_2100.nc'</span>)</span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>tas_projection_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(data_dir, <span class="st">'tas_monthly_canesm5_w5e5_rcp7_2015_2100.nc'</span>)</span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a><span class="co"># Run gaea</span></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a><span class="co"># The full run with raw climate data can take up to an hour</span></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a>gaea<span class="sc">::</span><span class="fu">yield_impact</span>(</span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a>  <span class="at">pr_hist_ncdf =</span> pr_historical_file, </span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a>  <span class="at">tas_hist_ncdf =</span> tas_historical_file, </span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a>  <span class="at">pr_proj_ncdf =</span> pr_projection_file, </span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a>  <span class="at">tas_proj_ncdf =</span> tas_projection_file, </span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a>  <span class="at">timestep =</span> <span class="st">'monthly'</span>,                   <span class="co"># specify the time step of the NetCDF data (monthly or daily)</span></span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a>  <span class="at">historical_periods =</span> <span class="fu">c</span>(<span class="dv">1950</span><span class="sc">:</span><span class="dv">2014</span>),      <span class="co"># vector of historical years selected for fitting</span></span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a>  <span class="at">climate_model =</span> <span class="st">'canesm5'</span>,              <span class="co"># label of climate model name</span></span>
<span id="cb1-30"><a href="#cb1-30" tabindex="-1"></a>  <span class="at">climate_scenario =</span> <span class="st">'gcam-ref'</span>,          <span class="co"># label of climate scenario name</span></span>
<span id="cb1-31"><a href="#cb1-31" tabindex="-1"></a>  <span class="at">member =</span> <span class="st">'r1i1p1f1'</span>,                    <span class="co"># label of ensemble member name</span></span>
<span id="cb1-32"><a href="#cb1-32" tabindex="-1"></a>  <span class="at">bias_adj =</span> <span class="st">'w5e5'</span>,                      <span class="co"># label of climate data for bias adjustment</span></span>
<span id="cb1-33"><a href="#cb1-33" tabindex="-1"></a>  <span class="at">cfe =</span> <span class="st">'no-cfe'</span>,                         <span class="co"># label of CO2 fertilization effect in the formula (default is no CFE)</span></span>
<span id="cb1-34"><a href="#cb1-34" tabindex="-1"></a>  <span class="at">gcam_version =</span> <span class="st">'gcam7'</span>,                 <span class="co"># output is different depending on the GCAM version (gcam6 or gcam7)</span></span>
<span id="cb1-35"><a href="#cb1-35" tabindex="-1"></a>  <span class="at">use_default_coeff =</span> <span class="cn">FALSE</span>,              <span class="co"># set to TRUE when there is no historical climate data available</span></span>
<span id="cb1-36"><a href="#cb1-36" tabindex="-1"></a>  <span class="at">base_year =</span> <span class="dv">2015</span>                        <span class="co"># GCAM base year</span></span>
<span id="cb1-37"><a href="#cb1-37" tabindex="-1"></a>  <span class="at">start_year =</span> <span class="dv">2015</span>,                      <span class="co"># start year of the projected climate data</span></span>
<span id="cb1-38"><a href="#cb1-38" tabindex="-1"></a>  <span class="at">end_year =</span> <span class="dv">2100</span>,                        <span class="co"># end year of the projected climate data</span></span>
<span id="cb1-39"><a href="#cb1-39" tabindex="-1"></a>  <span class="at">smooth_window =</span> <span class="dv">20</span>,                     <span class="co"># number of years as smoothing window</span></span>
<span id="cb1-40"><a href="#cb1-40" tabindex="-1"></a>  <span class="at">co2_hist =</span> <span class="cn">NULL</span>,                        <span class="co"># historical annual CO2 concentration. If NULL, will use default value</span></span>
<span id="cb1-41"><a href="#cb1-41" tabindex="-1"></a>  <span class="at">co2_proj =</span> <span class="cn">NULL</span>,                        <span class="co"># projected annual CO2 concentration. If NULL, will use default value</span></span>
<span id="cb1-42"><a href="#cb1-42" tabindex="-1"></a>  <span class="at">diagnostics =</span> <span class="cn">TRUE</span>,                     <span class="co"># set to TRUE to output diagnostic plots</span></span>
<span id="cb1-43"><a href="#cb1-43" tabindex="-1"></a>  <span class="at">output_dir =</span> <span class="st">'path/to/output/folder'</span>    <span class="co"># path to the output folder</span></span>
<span id="cb1-44"><a href="#cb1-44" tabindex="-1"></a>)</span></code></pre></div>
<p><br></p>
<div class="alert alert-info">
<p><strong>NOTE:</strong> The arguments <code>climate_model</code>,
<code>climate_scenario</code>, <code>member</code>,
<code>bias_adj</code>, and <code>cfe</code> require corresponding
strings that demonstrate climate model information in the output files.
These arguments will not affect <code>gaea</code> model simulation,
other than the meta information of climate data in the output files.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Mengqi Zhao, Stephanie Waldhoff, Claudia Tebaldi, Abigail Snyder.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
